<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø±ÙØ±Ø§Ù„ Ú©Ø¯Ù‡ | Ù…Ø±Ø¬Ø¹ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ú©Ø¯Ù‡Ø§ÛŒ Ù…Ø¹Ø±Ù</title>
    
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Vazirmatn', 'sans-serif'],
                    },
                    colors: {
                        primary: '#4f46e5', // Indigo 600
                        secondary: '#10b981', // Emerald 500
                        dark: '#0f172a', // Slate 900
                        card: '#1e293b', // Slate 800
                        danger: '#ef4444', // Red 500
                        warning: '#f59e0b', // Amber 500
                        gold: '#fbbf24',    // Amber 400
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
            /* Prevent pull-to-refresh on mobile */
            overscroll-behavior-y: none; 
        }
        /* Hide scrollbar for clean horizontal scroll */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .gradient-text {
            background: linear-gradient(to left, #818cf8, #34d399);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .glass-effect {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        /* Pinned Card Style */
        .pinned-card {
            border-color: #fbbf24 !important; /* Gold border */
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.15) !important;
            background: linear-gradient(to bottom right, #1e293b, rgba(251, 191, 36, 0.05));
        }
        .pinned-badge {
            position: absolute;
            top: -10px;
            left: 20px;
            background-color: #fbbf24;
            color: #0f172a;
            font-size: 0.75rem;
            font-weight: bold;
            padding: 2px 10px;
            border-radius: 9999px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            z-index: 10;
        }
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        .status-approved { background-color: rgba(16, 185, 129, 0.2); color: #34d399; }
        .status-pending { background-color: rgba(245, 158, 11, 0.2); color: #fbbf24; }
        .status-rejected { background-color: rgba(239, 68, 68, 0.2); color: #f87171; }
    </style>
</head>
<body class="bg-dark min-h-screen flex flex-col">

    <!-- Toast Notification Container -->
    <div id="toast-container" class="fixed bottom-5 left-5 z-50 flex flex-col gap-2"></div>

    <!-- ================= USER VIEW ================= -->
    <div id="user-view" class="flex flex-col min-h-screen">
        <!-- Header -->
        <header class="sticky top-0 z-40 w-full glass-effect border-b border-gray-700">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-primary to-secondary rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-primary/20">
                        <i class="fa-solid fa-link"></i>
                    </div>
                    <div class="flex flex-col">
                        <h1 class="text-xl md:text-2xl font-bold tracking-tight leading-none">Ø±ÙØ±Ø§Ù„ <span class="gradient-text">Ú©Ø¯Ù‡</span></h1>
                        <a href="https://t.me/Pooljoor" target="_blank" class="text-xs text-blue-400 hover:text-blue-300 transition-colors flex items-center gap-1 font-mono mt-0.5" dir="ltr">
                            <i class="fa-brands fa-telegram"></i> @Pooljoor
                        </a>
                    </div>
                    
                    <!-- Mobile Guide Button -->
                    <button onclick="openGuideModal()" class="md:hidden mr-2 w-8 h-8 rounded-full bg-gray-700/50 flex items-center justify-center text-gray-300 hover:text-white hover:bg-gray-600 transition-colors">
                        <i class="fa-solid fa-question text-sm"></i>
                    </button>
                </div>
                
                <div class="hidden md:flex items-center gap-6 text-gray-300 text-sm font-medium">
                    <a href="#" class="hover:text-white transition-colors">Ø®Ø§Ù†Ù‡</a>
                    <button onclick="openGuideModal()" class="hover:text-white transition-colors flex items-center gap-1">
                        <i class="fa-regular fa-circle-question"></i> Ø±Ø§Ù‡Ù†Ù…Ø§
                    </button>
                    <a href="#categories" class="hover:text-white transition-colors">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</a>
                </div>

                <button onclick="openModal()" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-lg shadow-primary/20 flex items-center gap-2">
                    <i class="fa-solid fa-plus"></i>
                    <span>Ø«Ø¨Øª Ú©Ø¯ Ø±Ø§ÛŒÚ¯Ø§Ù†</span>
                </button>
            </div>
        </header>

        <!-- Telegram Welcome Section (Only visible in TG) -->
        <div id="tg-welcome" class="hidden container mx-auto px-4 mt-4">
            <div class="bg-gradient-to-r from-blue-900/40 to-primary/20 border border-blue-500/30 rounded-xl p-3 flex items-center gap-3">
                <i class="fa-brands fa-telegram text-blue-400 text-2xl"></i>
                <div>
                    <p class="text-xs text-blue-300">Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ØŒ</p>
                    <p class="text-white font-bold text-sm" id="tg-username">Ú©Ø§Ø±Ø¨Ø± Ø¹Ø²ÛŒØ²</p>
                </div>
            </div>
        </div>

        <!-- Hero Section -->
        <section class="relative py-10 px-4 overflow-hidden">
            <div class="absolute top-0 right-0 w-96 h-96 bg-primary/20 rounded-full blur-3xl -z-10 translate-x-1/2 -translate-y-1/2"></div>
            <div class="absolute bottom-0 left-0 w-96 h-96 bg-secondary/10 rounded-full blur-3xl -z-10 -translate-x-1/2 translate-y-1/2"></div>

            <div class="container mx-auto text-center max-w-3xl">
                <h2 class="text-3xl md:text-5xl font-extrabold mb-6 leading-tight">
                    Ú©Ø¯ Ù…Ø¹Ø±Ù Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù‡ <br/>
                    <span class="gradient-text">Ù‡Ø²Ø§Ø±Ø§Ù† Ù†ÙØ±</span> Ù†Ù…Ø§ÛŒØ´ Ø¯Ù‡ÛŒØ¯
                </h2>
                
                <!-- Search Bar -->
                <div class="relative max-w-xl mx-auto group">
                    <div class="absolute inset-0 bg-gradient-to-r from-primary to-secondary rounded-xl blur opacity-25 group-hover:opacity-40 transition duration-300"></div>
                    <div class="relative flex items-center bg-card border border-gray-700 rounded-xl p-2 shadow-xl">
                        <i class="fa-solid fa-search text-gray-400 mr-3 ml-2 text-lg"></i>
                        <input type="text" id="searchInput" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ù†Ø§Ù… Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†..." class="bg-transparent border-none outline-none text-white w-full placeholder-gray-500 h-10">
                    </div>
                </div>
            </div>
        </section>

        <!-- Categories -->
        <section id="categories" class="container mx-auto px-4 mb-6">
            <div class="flex gap-3 overflow-x-auto no-scrollbar py-2" id="categoryFilters">
                <button class="filter-btn active whitespace-nowrap px-5 py-2 rounded-full bg-white text-dark font-bold text-sm transition-all" data-filter="all">Ù‡Ù…Ù‡</button>
                <button class="filter-btn whitespace-nowrap px-5 py-2 rounded-full bg-card border border-gray-700 text-gray-300 hover:border-gray-500 hover:text-white text-sm transition-all" data-filter="crypto">ğŸ’° ØµØ±Ø§ÙÛŒ</button>
                <button class="filter-btn whitespace-nowrap px-5 py-2 rounded-full bg-card border border-gray-700 text-gray-300 hover:border-gray-500 hover:text-white text-sm transition-all" data-filter="gold">ğŸ† Ø·Ù„Ø§</button>
                <button class="filter-btn whitespace-nowrap px-5 py-2 rounded-full bg-card border border-gray-700 text-gray-300 hover:border-gray-500 hover:text-white text-sm transition-all" data-filter="game">ğŸ® Ø¨Ø§Ø²ÛŒ</button>
                <button class="filter-btn whitespace-nowrap px-5 py-2 rounded-full bg-card border border-gray-700 text-gray-300 hover:border-gray-500 hover:text-white text-sm transition-all" data-filter="service">ğŸš• Ø®Ø¯Ù…Ø§ØªÛŒ</button>
            </div>
        </section>

        <!-- Cards Grid -->
        <main class="container mx-auto px-4 flex-grow pb-20">
            <div id="cardsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Cards will be injected via JS -->
            </div>
            
            <!-- Empty State -->
            <div id="emptyState" class="hidden text-center py-20">
                <i class="fa-solid fa-ghost text-6xl text-gray-700 mb-4"></i>
                <p class="text-gray-400 text-lg">Ù…ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯!</p>
            </div>
        </main>

        <!-- Footer -->
        <footer class="border-t border-gray-800 bg-dark py-8 mt-auto">
            <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
                <p>&copy; 1404 Ø±ÙØ±Ø§Ù„ Ú©Ø¯Ù‡. ØªÙ…Ø§Ù…ÛŒ Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª.</p>
                <div class="flex justify-center gap-4 mt-4 text-lg">
                    <a href="#" class="hover:text-primary"><i class="fa-brands fa-telegram"></i></a>
                    <a href="#" class="hover:text-primary"><i class="fa-brands fa-instagram"></i></a>
                    <a href="#" class="hover:text-primary"><i class="fa-brands fa-twitter"></i></a>
                </div>
                <button onclick="toggleAdminView()" class="mt-8 text-xs text-gray-700 hover:text-gray-500 transition-colors">
                    <i class="fa-solid fa-lock"></i> ÙˆØ±ÙˆØ¯ Ù…Ø¯ÛŒØ±Ø§Ù†
                </button>
            </div>
        </footer>
    </div>

    <!-- ================= ADMIN VIEW ================= -->
    <div id="admin-view" class="hidden min-h-screen bg-gray-900 flex">
        <!-- Sidebar -->
        <aside class="w-64 bg-card border-l border-gray-700 hidden md:flex flex-col p-4">
            <div class="flex items-center gap-2 mb-10 text-white font-bold text-xl">
                <i class="fa-solid fa-user-shield text-primary"></i>
                <span>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</span>
            </div>
            
            <nav class="space-y-2 flex-grow">
                <a href="#" class="flex items-center gap-3 px-4 py-3 bg-primary/10 text-primary rounded-xl font-medium">
                    <i class="fa-solid fa-gauge"></i> Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
                </a>
                <a href="#" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-gray-800 hover:text-white rounded-xl transition-colors">
                    <i class="fa-solid fa-users"></i> Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
                </a>
                <a href="#" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-gray-800 hover:text-white rounded-xl transition-colors">
                    <i class="fa-solid fa-gear"></i> ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                </a>
            </nav>

            <button onclick="toggleAdminView()" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-gray-800 rounded-xl transition-colors mt-auto">
                <i class="fa-solid fa-arrow-right-from-bracket"></i> Ø®Ø±ÙˆØ¬
            </button>
        </aside>

        <!-- Main Content -->
        <div class="flex-grow p-6 overflow-y-auto h-screen">
            <!-- Admin Header Mobile -->
            <div class="md:hidden flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-white">Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h2>
                <button onclick="toggleAdminView()" class="text-gray-400"><i class="fa-solid fa-times text-xl"></i></button>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-card border border-gray-700 p-5 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-400 text-xs mb-1">Ú©Ù„ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§</p>
                            <h3 class="text-2xl font-bold text-white" id="stat-total">0</h3>
                        </div>
                        <div class="bg-primary/20 p-2 rounded-lg text-primary"><i class="fa-solid fa-layer-group"></i></div>
                    </div>
                </div>
                <div class="bg-card border border-gray-700 p-5 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-400 text-xs mb-1">Ù¾ÛŒÙ† Ø´Ø¯Ù‡</p>
                            <h3 class="text-2xl font-bold text-gold" id="stat-pinned">0</h3>
                        </div>
                        <div class="bg-yellow-500/20 p-2 rounded-lg text-gold"><i class="fa-solid fa-thumbtack"></i></div>
                    </div>
                </div>
                <div class="bg-card border border-gray-700 p-5 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-400 text-xs mb-1">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯</p>
                            <h3 class="text-2xl font-bold text-warning" id="stat-pending">0</h3>
                        </div>
                        <div class="bg-warning/20 p-2 rounded-lg text-warning"><i class="fa-solid fa-clock"></i></div>
                    </div>
                </div>
                <div class="bg-card border border-gray-700 p-5 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-400 text-xs mb-1">Ø¨Ø§Ø²Ø¯ÛŒØ¯ Ø§Ù…Ø±ÙˆØ²</p>
                            <h3 class="text-2xl font-bold text-blue-400">1,204</h3>
                        </div>
                        <div class="bg-blue-500/20 p-2 rounded-lg text-blue-400"><i class="fa-solid fa-chart-line"></i></div>
                    </div>
                </div>
            </div>

            <!-- Table -->
            <div class="bg-card border border-gray-700 rounded-2xl overflow-hidden shadow-xl">
                <div class="p-6 border-b border-gray-700 flex flex-col md:flex-row justify-between items-center gap-4">
                    <h3 class="font-bold text-white">Ù…Ø¯ÛŒØ±ÛŒØª Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§</h3>
                    <div class="flex gap-2 w-full md:w-auto">
                        <!-- Admin Category Filter -->
                        <select id="adminCategoryFilter" onchange="handleAdminFilterChange(this.value)" class="bg-dark border border-gray-600 rounded-lg px-3 py-1 text-sm text-white focus:outline-none focus:border-primary cursor-pointer">
                            <option value="all">Ù‡Ù…Ù‡ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§</option>
                            <option value="crypto">ØµØ±Ø§ÙÛŒ Ùˆ Ú©Ø±ÛŒÙ¾ØªÙˆ</option>
                            <option value="gold">Ø·Ù„Ø§ Ùˆ Ø¬ÙˆØ§Ù‡Ø±</option>
                            <option value="game">Ø¨Ø§Ø²ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…ÛŒ</option>
                            <option value="service">Ø®Ø¯Ù…Ø§ØªÛŒ</option>
                        </select>
                        
                        <input type="text" id="adminSearchInput" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù„ÛŒØ³Øª..." class="bg-dark border border-gray-600 rounded-lg px-3 py-1 text-sm text-white focus:outline-none focus:border-primary flex-grow md:flex-grow-0">
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-right">
                        <thead class="bg-gray-800 text-gray-400 text-xs uppercase">
                            <tr>
                                <th class="px-6 py-4">Ø¢Ú¯Ù‡ÛŒ</th>
                                <th class="px-6 py-4">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</th>
                                <th class="px-6 py-4">Ú©Ø¯ / Ù„ÛŒÙ†Ú©</th>
                                <th class="px-6 py-4">ÙˆØ¶Ø¹ÛŒØª</th>
                                <th class="px-6 py-4 text-center">Ù¾ÛŒÙ†</th>
                                <th class="px-6 py-4 text-center">Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="adminTableBody" class="divide-y divide-gray-700 text-sm">
                            <!-- Admin Rows Injected Here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ================= MODALS ================= -->
    
    <!-- Guide Modal -->
    <div id="guideModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity" onclick="closeGuideModal()"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-2xl p-4">
            <div class="bg-card border border-gray-700 rounded-2xl shadow-2xl p-0 relative animate-fade-in-up overflow-hidden max-h-[90vh] flex flex-col">
                <!-- Header -->
                <div class="bg-dark/50 p-4 border-b border-gray-700 flex justify-between items-center flex-shrink-0">
                    <h3 class="text-xl font-bold text-white"><i class="fa-solid fa-book-open text-primary ml-2"></i>Ù…Ø±Ú©Ø² Ø¢Ù…ÙˆØ²Ø´</h3>
                    <button onclick="closeGuideModal()" class="text-gray-400 hover:text-white transition-colors bg-black/20 w-8 h-8 rounded-full flex items-center justify-center">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </div>

                <!-- Tabs -->
                <div class="flex border-b border-gray-700 bg-dark/30 flex-shrink-0">
                    <button onclick="switchGuideTab('general')" id="tab-general" class="flex-1 py-3 text-sm font-bold text-white border-b-2 border-primary bg-primary/5 transition-all">
                        <i class="fa-solid fa-gift ml-2"></i>Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø¯Ø§Ø´
                    </button>
                    <button onclick="switchGuideTab('kyc')" id="tab-kyc" class="flex-1 py-3 text-sm font-bold text-gray-400 hover:text-white hover:bg-white/5 border-b-2 border-transparent transition-all">
                        <i class="fa-solid fa-id-card ml-2"></i>Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
                    </button>
                </div>
                
                <!-- Content Container -->
                <div class="p-6 overflow-y-auto">
                    <!-- General Guide -->
                    <div id="guide-general" class="grid grid-cols-1 md:grid-cols-2 gap-6 animate-fade-in-up">
                        <div class="flex gap-4">
                            <div class="w-10 h-10 rounded-full bg-blue-500/20 text-blue-400 flex flex-shrink-0 items-center justify-center font-bold text-lg border border-blue-500/30">1</div>
                            <div>
                                <h4 class="font-bold text-white mb-1">Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ù„ØªÙØ±Ù…</h4>
                                <p class="text-gray-400 text-sm leading-relaxed">Ø§Ø² Ù„ÛŒØ³Øª Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ (Ø¨Ø§Ø²ÛŒØŒ ØµØ±Ø§ÙÛŒØŒ Ø·Ù„Ø§)ØŒ Ø³Ø±ÙˆÛŒØ³ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒØ¯.</p>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <div class="w-10 h-10 rounded-full bg-purple-500/20 text-purple-400 flex flex-shrink-0 items-center justify-center font-bold text-lg border border-purple-500/30">2</div>
                            <div>
                                <h4 class="font-bold text-white mb-1">Ú©Ù¾ÛŒ Ú©Ø¯ Ù…Ø¹Ø±Ù</h4>
                                <p class="text-gray-400 text-sm leading-relaxed">Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ <span class="bg-gray-700 px-1 rounded text-xs mx-1"><i class="fa-regular fa-copy"></i></span> Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ú©Ø¯ Ù…Ø¹Ø±Ù Ø¯Ø± Ø­Ø§ÙØ¸Ù‡ Ú©Ù¾ÛŒ Ø´ÙˆØ¯.</p>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <div class="w-10 h-10 rounded-full bg-yellow-500/20 text-yellow-400 flex flex-shrink-0 items-center justify-center font-bold text-lg border border-yellow-500/30">3</div>
                            <div>
                                <h4 class="font-bold text-white mb-1">Ø«Ø¨Øª Ù†Ø§Ù… Ø¨Ø§ Ù„ÛŒÙ†Ú©</h4>
                                <p class="text-gray-400 text-sm leading-relaxed">Ø§Ú¯Ø± Ø¯Ú©Ù…Ù‡ Â«ÙˆØ±ÙˆØ¯Â» ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ØŒ Ø±ÙˆÛŒ Ø¢Ù† Ø¨Ø²Ù†ÛŒØ¯. Ø§ÛŒÙ† Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ú©Ø¯ Ø±Ø§ Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø¹Ù…Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯.</p>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <div class="w-10 h-10 rounded-full bg-green-500/20 text-green-400 flex flex-shrink-0 items-center justify-center font-bold text-lg border border-green-500/30">4</div>
                            <div>
                                <h4 class="font-bold text-white mb-1">Ø¯Ø±ÛŒØ§ÙØª Ø¬Ø§ÛŒØ²Ù‡</h4>
                                <p class="text-gray-400 text-sm leading-relaxed">Ù‡Ù†Ú¯Ø§Ù… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø± Ø¨Ø®Ø´ "Refferal Code" Ú©Ø¯ÛŒ Ú©Ù‡ Ú©Ù¾ÛŒ Ú©Ø±Ø¯ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</p>
                            </div>
                        </div>
                        <div class="col-span-1 md:col-span-2 bg-gray-800/50 p-3 rounded-xl border border-gray-700 flex items-center gap-3 mt-2">
                            <i class="fa-regular fa-lightbulb text-yellow-400 text-lg"></i>
                            <p class="text-xs text-gray-400">Ø¨Ø±Ø§ÛŒ Ø±Ø¨Ø§Øªâ€ŒÙ‡Ø§ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…ÛŒ (Ù…Ø«Ù„ Ù‡Ù…Ø³ØªØ±)ØŒ ÙÙ‚Ø· Ú©Ø§ÙÛŒØ³Øª Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Â«ÙˆØ±ÙˆØ¯Â» Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯Ø› Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ú©Ø¯ Ù†ÛŒØ³Øª.</p>
                        </div>
                    </div>

                    <!-- KYC Guide -->
                    <div id="guide-kyc" class="hidden grid grid-cols-1 gap-4 animate-fade-in-up">
                        <div class="bg-orange-500/10 border border-orange-500/30 p-4 rounded-xl flex gap-3 items-start mb-2">
                            <i class="fa-solid fa-shield-halved text-orange-400 mt-1 text-xl"></i>
                            <div>
                                <h4 class="text-orange-400 font-bold text-sm">Ú†Ø±Ø§ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØªØŸ</h4>
                                <p class="text-gray-400 text-xs mt-1">ØµØ±Ø§ÙÛŒâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ Ùˆ Ù¾Ù„ØªÙØ±Ù…â€ŒÙ‡Ø§ÛŒ Ø·Ù„Ø§ Ø·Ø¨Ù‚ Ù‚Ø§Ù†ÙˆÙ† Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾ÙˆÙ„Ø´ÙˆÛŒÛŒ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ§ÛŒÛŒØ¯ Ù‡ÙˆÛŒØª Ø¯Ø§Ø±Ù†Ø¯.</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-dark/40 p-3 rounded-lg border border-gray-700 flex gap-3 items-center">
                                <i class="fa-solid fa-address-card text-2xl text-gray-500"></i>
                                <div><h5 class="text-white font-bold text-sm">Û±. Ù…Ø¯Ø§Ø±Ú© Ù‡ÙˆÛŒØªÛŒ</h5><p class="text-gray-500 text-xs">Ú©Ø§Ø±Øª Ù…Ù„ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ ÛŒØ§ Ø´Ù†Ø§Ø³Ù†Ø§Ù…Ù‡ Ø¬Ø¯ÛŒØ¯.</p></div>
                            </div>
                            <div class="bg-dark/40 p-3 rounded-lg border border-gray-700 flex gap-3 items-center">
                                <i class="fa-solid fa-mobile-screen-button text-2xl text-gray-500"></i>
                                <div><h5 class="text-white font-bold text-sm">Û². Ù…Ø§Ù„Ú©ÛŒØª Ø³ÛŒÙ…â€ŒÚ©Ø§Ø±Øª</h5><p class="text-gray-500 text-xs">Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ø§ÛŒØ¯ Ø­ØªÙ…Ø§Ù‹ Ø¨Ù‡ Ù†Ø§Ù… Ø®ÙˆØ¯ØªØ§Ù† Ø¨Ø§Ø´Ø¯.</p></div>
                            </div>
                            <div class="bg-dark/40 p-3 rounded-lg border border-gray-700 flex gap-3 items-center">
                                <i class="fa-solid fa-credit-card text-2xl text-gray-500"></i>
                                <div><h5 class="text-white font-bold text-sm">Û³. Ú©Ø§Ø±Øª Ø¨Ø§Ù†Ú©ÛŒ</h5><p class="text-gray-500 text-xs">Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª Ùˆ Ø´Ø¨Ø§ Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ù†Ø§Ù… ØµØ§Ø­Ø¨ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ø´Ø¯.</p></div>
                            </div>
                            <div class="bg-dark/40 p-3 rounded-lg border border-gray-700 flex gap-3 items-center">
                                <i class="fa-solid fa-camera text-2xl text-gray-500"></i>
                                <div><h5 class="text-white font-bold text-sm">Û´. Ø¹Ú©Ø³ Ùˆ ØªØ¹Ù‡Ø¯Ù†Ø§Ù…Ù‡</h5><p class="text-gray-500 text-xs">Ù†ÙˆØ´ØªÙ† Ù…ØªÙ† ØªØ¹Ù‡Ø¯ Ø±ÙˆÛŒ Ú©Ø§ØºØ° Ùˆ Ø¹Ú©Ø³ Ú¯Ø±ÙØªÙ† Ø¨Ø§ Ù…Ø¯Ø§Ø±Ú©.</p></div>
                            </div>
                        </div>
                        <div class="bg-red-500/10 border border-red-500/30 p-3 rounded-xl flex items-center gap-3 mt-2">
                            <i class="fa-solid fa-triangle-exclamation text-red-400"></i>
                            <p class="text-xs text-red-300"><strong>Ù‡Ø´Ø¯Ø§Ø± Ø§Ù…Ù†ÛŒØªÛŒ:</strong> Ù‡Ø±Ú¯Ø² Ø¹Ú©Ø³ Ù…Ø¯Ø§Ø±Ú© Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± ØªÙ„Ú¯Ø±Ø§Ù… ÛŒØ§ ÙˆØ§ØªØ³Ø§Ù¾ Ø¨Ø±Ø§ÛŒ Ø§ÙØ±Ø§Ø¯ Ù†Ø§Ø´Ù†Ø§Ø³ Ø§Ø±Ø³Ø§Ù„ Ù†Ú©Ù†ÛŒØ¯. Ù…Ø¯Ø§Ø±Ú© ÙÙ‚Ø· Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ø³Ø§ÛŒØª ÛŒØ§ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø±Ø³Ù…ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ Ø´ÙˆÙ†Ø¯.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Code Modal -->
    <div id="addModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/70 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-4">
            <div class="bg-card border border-gray-700 rounded-2xl shadow-2xl p-6 relative animate-fade-in-up">
                <button onclick="closeModal()" class="absolute top-4 left-4 text-gray-400 hover:text-white">
                    <i class="fa-solid fa-times text-xl"></i>
                </button>
                <h3 class="text-xl font-bold text-white mb-1">Ø«Ø¨Øª Ú©Ø¯ Ø¬Ø¯ÛŒØ¯</h3>
                <p class="text-gray-400 text-sm mb-6">Ø¢Ú¯Ù‡ÛŒ Ø´Ù…Ø§ Ù¾Ø³ Ø§Ø² ØªØ§ÛŒÛŒØ¯ Ù…Ø¯ÛŒØ± Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
                <form id="addForm" class="space-y-4" onsubmit="handleAddSubmit(event)">
                    <div>
                        <label class="block text-gray-400 text-xs mb-1">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</label>
                        <select required id="newCategory" class="w-full bg-dark border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-primary focus:outline-none">
                            <option value="crypto">ØµØ±Ø§ÙÛŒ Ùˆ Ú©Ø±ÛŒÙ¾ØªÙˆ</option>
                            <option value="gold">Ø·Ù„Ø§ Ùˆ Ø¬ÙˆØ§Ù‡Ø±</option>
                            <option value="game">Ø¨Ø§Ø²ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…ÛŒ</option>
                            <option value="service">Ø®Ø¯Ù…Ø§ØªÛŒ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-400 text-xs mb-1">Ù†Ø§Ù… Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† / Ø³Ø§ÛŒØª</label>
                        <input type="text" id="newTitle" required placeholder="Ù…Ø«Ù„Ø§Ù‹: Ù‡Ù…Ø³ØªØ± Ú©Ø§Ù…Ø¨Øª" class="w-full bg-dark border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-primary focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-xs mb-1">Ú©Ø¯ Ù…Ø¹Ø±Ù</label>
                        <input type="text" id="newCode" placeholder="CODE123" class="w-full bg-dark border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-primary focus:outline-none font-mono text-left" dir="ltr">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-xs mb-1">Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª</label>
                        <input type="url" id="newLink" placeholder="https://..." class="w-full bg-dark border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-primary focus:outline-none font-mono text-left" dir="ltr">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-xs mb-1">Ù¾Ø§Ø¯Ø§Ø´ / ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
                        <textarea id="newDesc" required placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ú©ÙˆØªØ§Ù‡..." rows="2" class="w-full bg-dark border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-primary focus:outline-none"></textarea>
                    </div>
                    <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-3 rounded-xl transition-all shadow-lg shadow-primary/20 mt-2">
                        Ø«Ø¨Øª Ø¢Ú¯Ù‡ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù†
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- NEW: Edit Code Modal -->
    <div id="editModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/70 backdrop-blur-sm transition-opacity" onclick="closeEditModal()"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-4">
            <div class="bg-card border border-gray-700 rounded-2xl shadow-2xl p-6 relative animate-fade-in-up">
                <button onclick="closeEditModal()" class="absolute top-4 left-4 text-gray-400 hover:text-white">
                    <i class="fa-solid fa-times text-xl"></i>
                </button>
                <h3 class="text-xl font-bold text-white mb-1"><i class="fa-solid fa-pen-to-square ml-2 text-blue-400"></i>ÙˆÛŒØ±Ø§ÛŒØ´ Ø¢Ú¯Ù‡ÛŒ</h3>
                <p class="text-gray-400 text-sm mb-6">ØªØºÛŒÛŒØ±Ø§Øª Ø¨Ù„Ø§ÙØ§ØµÙ„Ù‡ Ø§Ø¹Ù…Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.</p>
                <form id="editForm" class="space-y-4" onsubmit="handleEditSubmit(event)">
                    <input type="hidden" id="editId">
                    <div>
                        <label class="block text-gray-400 text-xs mb-1">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</label>
                        <select required id="editCategory" class="w-full bg-dark border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-primary focus:outline-none">
                            <option value="crypto">ØµØ±Ø§ÙÛŒ Ùˆ Ú©Ø±ÛŒÙ¾ØªÙˆ</option>
                            <option value="gold">Ø·Ù„Ø§ Ùˆ Ø¬ÙˆØ§Ù‡Ø±</option>
                            <option value="game">Ø¨Ø§Ø²ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…ÛŒ</option>
                            <option value="service">Ø®Ø¯Ù…Ø§ØªÛŒ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-400 text-xs mb-1">Ù†Ø§Ù… Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† / Ø³Ø§ÛŒØª</label>
                        <input type="text" id="editTitle" required class="w-full bg-dark border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-primary focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-xs mb-1">Ú©Ø¯ Ù…Ø¹Ø±Ù</label>
                        <input type="text" id="editCode" class="w-full bg-dark border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-primary focus:outline-none font-mono text-left" dir="ltr">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-xs mb-1">Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª</label>
                        <input type="url" id="editLink" class="w-full bg-dark border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-primary focus:outline-none font-mono text-left" dir="ltr">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-xs mb-1">Ù¾Ø§Ø¯Ø§Ø´ / ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
                        <textarea id="editDesc" required rows="2" class="w-full bg-dark border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-primary focus:outline-none"></textarea>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-xl transition-all shadow-lg shadow-blue-500/20 mt-2">
                        Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // Telegram WebApp Initialization
        document.addEventListener("DOMContentLoaded", function() {
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                
                // Notify Telegram that the app is ready
                tg.ready();
                
                // Expand to full height
                tg.expand();
                
                // Check for user data
                if(tg.initDataUnsafe && tg.initDataUnsafe.user) {
                    const user = tg.initDataUnsafe.user;
                    const welcomeDiv = document.getElementById('tg-welcome');
                    const usernameSpan = document.getElementById('tg-username');
                    
                    if(welcomeDiv && usernameSpan) {
                        welcomeDiv.classList.remove('hidden');
                        usernameSpan.innerText = (user.first_name || '') + ' ' + (user.last_name || '');
                    }
                }
            }
        });

        // Data Store
        const initialData = [
            // Pinned Item Example
            { id: 1, title: "Ù‡Ù…Ø³ØªØ± Ú©Ø§Ù…Ø¨Øª", category: "game", description: "Ø¨Ø§ Ù„ÛŒÙ†Ú© Ù…Ù† ÙˆØ§Ø±Ø¯ Ø´Ùˆ Ùˆ ÛµÛ°Û°Û° Ø³Ú©Ù‡ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø¨Ú¯ÛŒØ± + Ù¾Ø±ÙˆÙÛŒØª Ø¨Ø§Ù„Ø§ØªØ±!", code: null, link: "https://t.me/hamster", icon: "fa-gamepad", color: "text-purple-400", views: 1205, status: 'approved', pinned: true },
            
            { id: 2, title: "Ù†ÙˆØ¨ÛŒØªÚ©Ø³", category: "crypto", description: "Û³Û°Ùª ØªØ®ÙÛŒÙ Ú©Ø§Ø±Ù…Ø²Ø¯.", code: "REF123", link: "https://nobitex.ir", icon: "fa-bitcoin", color: "text-yellow-400", views: 850, status: 'approved', pinned: false },
            { id: 7, title: "Ù…ÛŒÙ„ÛŒ (Milli)", category: "gold", description: "Ûµ Ù…ÛŒÙ„ÛŒ Ø·Ù„Ø§ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù†.", code: "MILLI-G", link: "https://milli.gold", icon: "fa-medal", color: "text-yellow-500", views: 540, status: 'approved', pinned: false },
            { id: 3, title: "Ø§Ø³Ù†Ù¾", category: "service", description: "ØªØ®ÙÛŒÙ Û´Û° ØªÙˆÙ…Ù†ÛŒ.", code: "SN-99", link: null, icon: "fa-taxi", color: "text-green-400", views: 2100, status: 'approved', pinned: false },
            { id: 8, title: "Ø·Ù„Ø§Ø³ÛŒ", category: "gold", description: "Ø³Ø§Ù…Ø§Ù†Ù‡ Ø®Ø±ÛŒØ¯ Ùˆ ÙØ±ÙˆØ´ Ø·Ù„Ø§ÛŒ Ø¢Ø¨ Ø´Ø¯Ù‡.", code: "TALASI-99", link: "https://talasi.ir", icon: "fa-ring", color: "text-amber-300", views: 320, status: 'approved', pinned: false },
            { id: 99, title: "Ù¾Ø±ÙˆÚ˜Ù‡ Ø§ÛŒÚ©Ø³", category: "crypto", description: "ØªØ³Øª Ú©Ø§Ø±Ø¨Ø± Ù…Ù†ØªØ¸Ø± ØªØ§ÛŒÛŒØ¯.", code: "TEST", link: null, icon: "fa-question", color: "text-gray-400", views: 0, status: 'pending', pinned: true },
        ];

        let referrals = [...initialData];

        // --- View Management ---
        const userView = document.getElementById('user-view');
        const adminView = document.getElementById('admin-view');

        function toggleAdminView() {
            if (adminView.classList.contains('hidden')) {
                // Show Admin
                userView.classList.add('hidden');
                adminView.classList.remove('hidden');
                renderAdminTable();
                updateStats();
                showToast('Ø¨Ù‡ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯', 'success');
            } else {
                // Show User
                adminView.classList.add('hidden');
                userView.classList.remove('hidden');
                applyFilters(); 
            }
        }

        // --- User Side Logic ---
        const grid = document.getElementById('cardsGrid');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const searchInput = document.getElementById('searchInput');
        const modal = document.getElementById('addModal');
        const emptyState = document.getElementById('emptyState');
        let currentFilter = 'all';

        function renderCards(data) {
            grid.innerHTML = '';
            // Only show approved items in user view
            let visibleData = data.filter(item => item.status === 'approved');
            
            // SORTING LOGIC: Pinned items FIRST
            visibleData.sort((a, b) => {
                if (a.pinned && !b.pinned) return -1;
                if (!a.pinned && b.pinned) return 1;
                return 0;
            });
            
            if (visibleData.length === 0) {
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
            }

            visibleData.forEach(item => {
                const card = document.createElement('div');
                const pinnedClass = item.pinned ? 'pinned-card relative' : 'bg-card border-gray-700 hover:border-gray-500';
                card.className = `${pinnedClass} border rounded-2xl p-5 transition-all hover:-translate-y-1 shadow-xl flex flex-col h-full`;
                
                let pinnedBadge = '';
                if(item.pinned) {
                    pinnedBadge = `<div class="pinned-badge"><i class="fa-solid fa-thumbtack"></i> Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ ÙˆÛŒÚ˜Ù‡</div>`;
                }

                let actionButtons = '';
                if (item.code) {
                    actionButtons += `<button onclick="copyToClipboard('${item.code}')" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white py-2.5 rounded-xl text-sm font-medium transition-colors flex items-center justify-center gap-2 group"><span class="font-mono bg-black/20 px-2 rounded text-xs text-gray-300 group-hover:text-white">${item.code}</span><i class="fa-regular fa-copy"></i></button>`;
                }
                if (item.link) {
                    actionButtons += `<a href="${item.link}" target="_blank" class="flex-1 bg-primary hover:bg-primary/90 text-white py-2.5 rounded-xl text-sm font-medium transition-colors flex items-center justify-center gap-2 text-center">ÙˆØ±ÙˆØ¯ <i class="fa-solid fa-arrow-up-right-from-square text-xs"></i></a>`;
                }

                card.innerHTML = `
                    ${pinnedBadge}
                    <div class="flex justify-between items-start mb-4 ${item.pinned ? 'mt-3' : ''}">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-full bg-dark flex items-center justify-center border border-gray-700 text-2xl ${item.color}"><i class="fa-solid ${item.icon}"></i></div>
                            <div>
                                <h3 class="font-bold text-lg text-white leading-tight">${item.title}</h3>
                                <span class="text-xs text-gray-500 bg-gray-800 px-2 py-0.5 rounded-full border border-gray-700 mt-1 inline-block">${getCategoryName(item.category)}</span>
                            </div>
                        </div>
                        <div class="text-gray-500 text-xs flex items-center gap-1"><i class="fa-regular fa-eye"></i> ${item.views}</div>
                    </div>
                    <p class="text-gray-400 text-sm mb-6 flex-grow leading-relaxed">${item.description}</p>
                    <div class="flex gap-2 mt-auto">${actionButtons}</div>
                `;
                grid.appendChild(card);
            });
        }

        function getCategoryName(cat) {
            const map = { 'crypto': 'Ú©Ø±ÛŒÙ¾ØªÙˆ', 'game': 'Ø¨Ø§Ø²ÛŒ', 'service': 'Ø®Ø¯Ù…Ø§ØªÛŒ', 'gold': 'Ø·Ù„Ø§ Ùˆ Ø¬ÙˆØ§Ù‡Ø±' };
            return map[cat] || 'Ø¹Ù…ÙˆÙ…ÛŒ';
        }

        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                filterBtns.forEach(b => { b.classList.remove('bg-white', 'text-dark', 'font-bold'); b.classList.add('bg-card', 'text-gray-300'); });
                btn.classList.remove('bg-card', 'text-gray-300'); btn.classList.add('bg-white', 'text-dark', 'font-bold');
                currentFilter = btn.dataset.filter;
                applyFilters();
            });
        });

        searchInput.addEventListener('input', applyFilters);

        function applyFilters() {
            const query = searchInput.value.toLowerCase();
            const filtered = referrals.filter(item => {
                const matchesCategory = currentFilter === 'all' || item.category === currentFilter;
                const matchesSearch = item.title.toLowerCase().includes(query) || item.description.toLowerCase().includes(query);
                return matchesCategory && matchesSearch;
            });
            renderCards(filtered);
        }

        // --- Admin Side Logic ---
        let adminCategory = 'all';
        const adminSearchInput = document.getElementById('adminSearchInput');

        adminSearchInput.addEventListener('input', () => { renderAdminTable(); });
        function handleAdminFilterChange(value) { adminCategory = value; renderAdminTable(); }

        function renderAdminTable() {
            const tbody = document.getElementById('adminTableBody');
            tbody.innerHTML = '';
            
            const searchQuery = adminSearchInput.value.toLowerCase();
            let filteredData = referrals.filter(item => {
                const matchCategory = adminCategory === 'all' || item.category === adminCategory;
                const matchSearch = item.title.toLowerCase().includes(searchQuery) || (item.code && item.code.toLowerCase().includes(searchQuery));
                return matchCategory && matchSearch;
            });

            const sortedData = filteredData.sort((a, b) => {
                if (a.status === 'pending' && b.status !== 'pending') return -1;
                if (a.status !== 'pending' && b.status === 'pending') return 1;
                if (a.pinned && !b.pinned) return -1;
                if (!a.pinned && b.pinned) return 1;
                return b.id - a.id;
            });

            if (sortedData.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" class="px-6 py-8 text-center text-gray-500">Ù…ÙˆØ±Ø¯ÛŒ Ø¨Ø§ Ø§ÛŒÙ† ÙÛŒÙ„ØªØ± ÛŒØ§ÙØª Ù†Ø´Ø¯.</td></tr>`;
                return;
            }

            sortedData.forEach(item => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-gray-800/50 transition-colors";
                
                let statusBadge = '';
                if(item.status === 'approved') statusBadge = '<span class="status-badge status-approved">ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡</span>';
                else if(item.status === 'pending') statusBadge = '<span class="status-badge status-pending">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</span>';
                else statusBadge = '<span class="status-badge status-rejected">Ø±Ø¯ Ø´Ø¯Ù‡</span>';

                let actions = '';
                if (item.status === 'pending') {
                    actions = `
                        <button onclick="changeStatus(${item.id}, 'approved')" class="text-secondary hover:bg-secondary/10 p-2 rounded-lg" title="ØªØ§ÛŒÛŒØ¯"><i class="fa-solid fa-check"></i></button>
                        <button onclick="changeStatus(${item.id}, 'rejected')" class="text-danger hover:bg-danger/10 p-2 rounded-lg" title="Ø±Ø¯"><i class="fa-solid fa-ban"></i></button>
                    `;
                } else {
                    actions = `
                        <button onclick="deleteReferral(${item.id})" class="text-gray-400 hover:text-danger hover:bg-danger/10 p-2 rounded-lg" title="Ø­Ø°Ù"><i class="fa-solid fa-trash"></i></button>
                    `;
                }
                
                const pinBtnClass = item.pinned ? 'text-gold bg-yellow-500/10' : 'text-gray-600 hover:text-gray-400';
                const pinAction = `<button onclick="togglePin(${item.id})" class="${pinBtnClass} p-2 rounded-lg transition-colors" title="${item.pinned ? 'Ø¨Ø±Ø¯Ø§Ø´ØªÙ† Ù¾ÛŒÙ†' : 'Ù¾ÛŒÙ† Ú©Ø±Ø¯Ù†'}"><i class="fa-solid fa-thumbtack"></i></button>`;

                // NEW: Edit Button
                const editAction = `<button onclick="openEditModal(${item.id})" class="text-blue-400 hover:bg-blue-500/10 p-2 rounded-lg" title="ÙˆÛŒØ±Ø§ÛŒØ´"><i class="fa-solid fa-pen"></i></button>`;

                tr.innerHTML = `
                    <td class="px-6 py-4 flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-dark border border-gray-700 flex items-center justify-center ${item.color}"><i class="fa-solid ${item.icon}"></i></div>
                        <span class="text-white font-medium">${item.title}</span>
                    </td>
                    <td class="px-6 py-4 text-gray-400">${getCategoryName(item.category)}</td>
                    <td class="px-6 py-4 font-mono text-gray-400 text-xs">${item.code || 'Ù„ÛŒÙ†Ú©'}</td>
                    <td class="px-6 py-4">${statusBadge}</td>
                    <td class="px-6 py-4 text-center">${pinAction}</td>
                    <td class="px-6 py-4 flex justify-center gap-1">
                        ${editAction}
                        ${actions}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function updateStats() {
            document.getElementById('stat-total').innerText = referrals.length;
            document.getElementById('stat-pending').innerText = referrals.filter(i => i.status === 'pending').length;
            document.getElementById('stat-pinned').innerText = referrals.filter(i => i.pinned).length;
            document.getElementById('stat-approved').innerText = referrals.filter(i => i.status === 'approved').length;
        }

        function togglePin(id) {
            const index = referrals.findIndex(i => i.id === id);
            if (index !== -1) {
                referrals[index].pinned = !referrals[index].pinned;
                renderAdminTable();
                updateStats();
                const msg = referrals[index].pinned ? 'Ø¢Ú¯Ù‡ÛŒ Ù¾ÛŒÙ† Ø´Ø¯' : 'Ù¾ÛŒÙ† Ø¢Ú¯Ù‡ÛŒ Ø¨Ø±Ø¯Ø§Ø´ØªÙ‡ Ø´Ø¯';
                showToast(msg, 'success');
            }
        }

        function changeStatus(id, newStatus) {
            const index = referrals.findIndex(i => i.id === id);
            if (index !== -1) {
                referrals[index].status = newStatus;
                renderAdminTable();
                updateStats();
                showToast(`ÙˆØ¶Ø¹ÛŒØª ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.`, 'success');
            }
        }

        function deleteReferral(id) {
            if(confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø¢Ú¯Ù‡ÛŒ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) {
                referrals = referrals.filter(i => i.id !== id);
                renderAdminTable();
                updateStats();
                showToast('Ø¢Ú¯Ù‡ÛŒ Ø­Ø°Ù Ø´Ø¯.', 'error');
            }
        }

        // --- Edit Logic (New) ---
        const editModal = document.getElementById('editModal');
        
        function openEditModal(id) {
            const item = referrals.find(i => i.id === id);
            if(!item) return;

            document.getElementById('editId').value = item.id;
            document.getElementById('editCategory').value = item.category;
            document.getElementById('editTitle').value = item.title;
            document.getElementById('editCode').value = item.code || '';
            document.getElementById('editLink').value = item.link || '';
            document.getElementById('editDesc').value = item.description;

            editModal.classList.remove('hidden');
        }

        function closeEditModal() {
            editModal.classList.add('hidden');
        }

        function handleEditSubmit(e) {
            e.preventDefault();
            const id = parseInt(document.getElementById('editId').value);
            const index = referrals.findIndex(i => i.id === id);
            
            if(index !== -1) {
                referrals[index].title = document.getElementById('editTitle').value;
                referrals[index].category = document.getElementById('editCategory').value;
                referrals[index].code = document.getElementById('editCode').value || null;
                referrals[index].link = document.getElementById('editLink').value || null;
                referrals[index].description = document.getElementById('editDesc').value;

                // Update Icon/Color based on category (simple logic)
                // You could expand this to let user pick icon
                
                showToast('ØªØºÛŒÛŒØ±Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.', 'success');
                closeEditModal();
                renderAdminTable();
                applyFilters(); // Update user view as well
            }
        }

        // --- Shared Functions ---
        function openModal() { modal.classList.remove('hidden'); }
        function closeModal() { modal.classList.add('hidden'); }
        
        // Guide Modal Functions
        const guideModal = document.getElementById('guideModal');
        const tabGeneral = document.getElementById('tab-general');
        const tabKyc = document.getElementById('tab-kyc');
        const contentGeneral = document.getElementById('guide-general');
        const contentKyc = document.getElementById('guide-kyc');

        function openGuideModal() { 
            guideModal.classList.remove('hidden'); 
            switchGuideTab('general'); 
        }
        function closeGuideModal() { guideModal.classList.add('hidden'); }

        function switchGuideTab(tab) {
            if(tab === 'general') {
                tabGeneral.classList.add('text-white', 'border-primary', 'bg-primary/5');
                tabGeneral.classList.remove('text-gray-400', 'border-transparent');
                tabKyc.classList.remove('text-white', 'border-primary', 'bg-primary/5');
                tabKyc.classList.add('text-gray-400', 'border-transparent');
                contentGeneral.classList.remove('hidden');
                contentKyc.classList.add('hidden');
            } else {
                tabKyc.classList.add('text-white', 'border-primary', 'bg-primary/5');
                tabKyc.classList.remove('text-gray-400', 'border-transparent');
                tabGeneral.classList.remove('text-white', 'border-primary', 'bg-primary/5');
                tabGeneral.classList.add('text-gray-400', 'border-transparent');
                contentKyc.classList.remove('hidden');
                contentGeneral.classList.add('hidden');
            }
        }

        function handleAddSubmit(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> ...';
            btn.disabled = true;

            const newItem = {
                id: Date.now(),
                title: document.getElementById('newTitle').value,
                category: document.getElementById('newCategory').value,
                description: document.getElementById('newDesc').value,
                code: document.getElementById('newCode').value || null,
                link: document.getElementById('newLink').value || null,
                icon: "fa-rocket",
                color: "text-gray-300",
                views: 0,
                status: 'pending', 
                pinned: true      
            };

            setTimeout(() => {
                referrals.unshift(newItem); 
                showToast('Ø¢Ú¯Ù‡ÛŒ Ø«Ø¨Øª Ø´Ø¯ Ùˆ Ù¾Ø³ Ø§Ø² ØªØ§ÛŒÛŒØ¯ Ù…Ø¯ÛŒØ±ØŒ Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ Ù„ÛŒØ³Øª (Ù¾ÛŒÙ† Ø´Ø¯Ù‡) Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.', 'success');
                closeModal();
                e.target.reset();
                btn.innerHTML = 'Ø«Ø¨Øª Ø¢Ú¯Ù‡ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù†';
                btn.disabled = false;
                applyFilters(); 
            }, 1000);
        }

        function copyToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed"; textArea.style.left = "-9999px";
            document.body.appendChild(textArea);
            textArea.focus(); textArea.select();
            try {
                document.execCommand('copy');
                showToast(`Ú©Ø¯ "${text}" Ú©Ù¾ÛŒ Ø´Ø¯!`, 'success');
            } catch (err) { showToast('Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ.', 'error'); }
            document.body.removeChild(textArea);
        }

        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const colorClass = type === 'success' ? 'border-secondary/50 text-secondary' : 'border-red-500/50 text-red-400';
            const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
            toast.className = `bg-card border ${colorClass} text-white px-4 py-3 rounded-xl shadow-lg flex items-center gap-3 min-w-[300px] animate-slide-in`;
            toast.innerHTML = `<i class="fa-solid ${icon} text-lg"></i><span class="text-sm font-medium">${message}</span>`;
            toastContainer.appendChild(toast);
            setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 300); }, 3000);
        }

        // Init
        renderCards(referrals);
    </script>
    <style>
        @keyframes slideIn { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .animate-slide-in { animation: slideIn 0.3s ease-out forwards; }
        @keyframes fadeInUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-fade-in-up { animation: fadeInUp 0.3s ease-out forwards; }
    </style>
</body>
</html>


